# Kid Library - Feature Extension ðŸ“š

## Introduction

The Kid Library app is an application built with React, Express, Node, and MySQL and styled with Bootstrap. It uses React-Router to enable multiple page navigation and the Google Books API to access book details and information.

This document covers the original build  and the feature extension. [Here](https://github.com/crwainstock/mvp) you can find the original project documentation!

Feature extensions:

- User authentication & verification
  - User can create account and login
  - Home, MyLibraryView and BookDetailView pages are protected
- StarRating functionality in BookDetailView page.

## Setup

### Dependencies

- Run `npm install` in project directory. This will install server-related dependencies such as `express`.
- `cd client` and run `npm install`. This will install client dependencies (React).

### Database Prep

- Access the MySQL interface in your terminal by running `mysql -u root -p` or use the MySQL CLI.
- Create a new database called mybooks: `create database mybooks`
- Add a `.env` file to the project folder of this repository containing the MySQL authentication information for MySQL user. For example:

```bash
  DB_HOST=localhost
  DB_USER=root
  DB_NAME=mybooks
  DB_PASS=YOURPASSWORD
  SUPER_SECRET=shhhhhhhhh
```

- Run `npm run migrate` in the my-express-app folder of this repository, in a new terminal window. This will create a table called 'mylibrary' and 'users' in your database.

- IF THIS DOESN'T WORK for some reason, you could also create a table manually in the MySQL CLI using the following commands:

To create the mylibrary table:

```
CREATE TABLE mylibrary (
   id int NOT NULL AUTO_INCREMENT,
   bookId varchar(40),
   rating int,
   review varchar(255),
   PRIMARY KEY (id)
);
```

To make the bookId column is unique (unable to have duplicate entries):

``` 
ALTER TABLE mylibrary
ADD CONSTRAINT unique_bookid UNIQUE KEY(bookId);
```

To create the users table:

```
CREATE TABLE users(
     id INT NOT NULL AUTO_INCREMENT,
     email VARCHAR(255) NOT NULL, 
     username VARCHAR(255) NOT NULL, 
     password VARCHAR(255) NOT NULL, 
     PRIMARY KEY (id)
);
```

To make the username column is unique (unable to have duplicate entries):

```
ALTER TABLE users
ADD CONSTRAINT unique_username UNIQUE KEY(username);
```

- Make sure you understand how the `mylibrary` and `users` table is constructed. In your MySQL console, you can run `use mybooks;` and then `describe mylibrary;` to see the structure of the tables. Same for `users`.

- Notes about mylibrary table:

  - `id` -- This column is generated automatically in the database. It serves as the primary key for the table. This is what is being referred to if id is mentioned in the comments in the code.
  - `bookId` -- This column is taken from the Google Books API. It is integral to the functionality of the app. It is what connects the database to the book detail information in the Google API. Initially, this was used as the id for the table, but there were some problems related to the values not being numerical. This is what is being referenced if bookId is mentioned in the comments in the code.
  - `rating` -- This column holds a numerical rating for each book generated by users in the book details view page. It can be empty.
  - `review` -- This column holds review data generated by users in the book details view page. It can be empty.

- Notes about users table:

  - `id` -- This column is generated automatically in the database. It serves as the primary key for the table.
  - `email` -- This column holds user's email. This is currently not used, but could be for future functionality.
  - `username` -- This column holds a unique username for each user. It can't be empty.
  - `password` -- This column holds an encrypted password.

- There is also a `mybooks_dump.sql` and `users_dump.sql` file in the my-express-app folder with sample data you can use to create a database.

### Development

- Open a terminal, and do `cd my-express-app`. Run `npm start` to start the Express server on port 5000.
- In another terminal, do `cd my-express-app` and then `cd client` and run `npm start` to start the client in development mode with hot reloading in port 3000.

- _Note_: The client folder holds everything to do with the front end of the app. The my-express-app encapsulates the whole app, including all back end files and the client files.

- _Note for Crystal_: If you are not cloning the full repo, you will need to run `npm install jsonwebtoken bcrypt` ,  `npm install striptags` and `npm install react-icons --save` to use these components. `striptags` removes the html tags and `react-icons` imports the star icon component in BookDetailView page. `jsonwebtoken bcrypt` will encrypt user passwords.

## Code & Functionality Overview

- **Front End**

  - This project includes pages and components.
    - `App.js` is where the routes (pages) are defined.
    - Routes (pages) are split into public and private routes using the `PrivateRoute` component.

  - **Pages/Components** include:

  - **Public**
    - `DashBoard` page "/". This page renders the `Auth` component.

  - **Private**
    - `PrivateRoute` component "/private". This protects the below/nested pages. Users can only only access these pages when logged in. Once logged in, this component also renders the `NavBar` component across below/nested pages.
      - `Home` page "/private". This page renders the `MyLibraryWidget` and `Search` components.
      - `MyLibraryView` page "private/mylibrary"
      - `BookDetailView` page "private/mylibrary/${bookId}". This page renders the `StarRating` component.

- Each page includes code to fetch data from the external API and/or database.
- Since only the bookId (from the external API) is stored in the database, this value is used to search the Google Books API and return the detailed book information. It is also used in the `BookDetailView` to search the database and return the review data.

- You can see more about front end functions and how they're organized in each page/component in [this document](https://docs.google.com/document/d/16H9LM7R9L0kpnlxoho1FrG1MixFCQ_XpMKUT5S937Tk/edit?usp=sharing).

- **Back End**
  - The project uses `mylibrary` MySQL table to store user-generated data (reviews) and `users` table to store user info. `mylibrary` is linked to the external API through use of the bookId values.
  - `index.js` includes all of the router functions.
    - The project uses **node-fetch** to allow for the use of fetch in the back end. You can read more about node-fetch [here](https://www.npmjs.com/package/node-fetch) if you're interested.
      - Because the external API is accessed on the back end, fetches made from the front end include the URLs built for the project (rather than the Google API URLs).
  - You can see more about router functions and how they're organized in [this document](https://docs.google.com/document/d/15Zsi57j_uF6vQbdLi3YIE2zm1OKTCM4QIMPd1E8kLK0/edit?usp=sharing).
  - `users.js` includes all of the routes functions for user registration, login and verification (i.e. protecting pages from being viewed by users who are not logged in).

## Contributing to the Project

Please follow the basic contribution guidelines in the Contributor Covenant.

[![Contributor Covenant](https://img.shields.io/badge/Contributor%20Covenant-2.1-4baaaa.svg)](https://www.contributor-covenant.org/version/2/1/code_of_conduct/)

## Thank you!